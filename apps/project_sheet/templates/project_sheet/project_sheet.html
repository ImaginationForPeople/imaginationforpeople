{% extends "project_sheet/project_base.html" %}

{% load i18n %}
{% load localeurl_tags %}
{% load tagging_tags %}

{% block meta_desc %}{{project_translation.about_section|truncatewords:60}}{% endblock %}
{% block title %}
    {% if project_translation.title %}
        {{project_translation.title|capfirst}} 
    {% else %}
        {% trans 'start project'|capfirst %}
    {% endif %}
    | Imagination for People
{% endblock %}

{% block extra_head %}
  {{ block.super }}
	<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}/css/jquery/jquery.ui.autocomplete.tagit.css" media="screen, projection" />
	<link rel="stylesheet" href="{{ MEDIA_URL }}/css/anythingslider.css" type="text/css" media="screen" />
	<link rel="stylesheet" href="{{ MEDIA_URL }}/css/superfish.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="{{ MEDIA_URL }}/css/confirm.css" type="text/css" media="screen" />
	
	<script type="text/javascript" src="{{ MEDIA_URL }}/js/jquery/jquery.blockUI.js" ></script>
	
	<!-- inline  -->
	<script type="text/javascript" src="{{ MEDIA_URL }}/js/jquery/jquery.jeditable.js"></script>

	<!-- for tags -->
	<script type="text/javascript" src="{{ MEDIA_URL }}/js/jquery/jquery.tag-it.js"></script>
	<script type="text/javascript" src="{{ MEDIA_URL }}/js/jquery/jquery.tag-it.iecompat.js"></script>
	<script type="text/javascript" src="{{ MEDIA_URL }}/js/jquery/jquery.tinysort.js"></script>
	<script type="text/javascript" src="{{ MEDIA_URL }}/js/jquery/jquery.tagcloud.js"></script>

	<script type="text/javascript" src="{{ MEDIA_URL }}/js/jquery/jquery.ba-serializeobject.js"></script>
	<script type="text/javascript" src="{{ MEDIA_URL }}/js/jquery/jquery.dajax.core.js"></script>
	<script type="text/javascript" src="/js/dajax/dajaxice.core.js"></script>
	
	<!-- Scripts for Image Slider & Miniatures -->
	<script type="text/javascript" src="{{ MEDIA_URL }}/js/jquery/jquery.easing.1.2.js"></script>
	<script type="text/javascript" src="{{ MEDIA_URL }}/js/jquery/jquery.anythingslider.js" ></script>
	<script type="text/javascript" src="{{ MEDIA_URL }}/js/jquery/jquery.jcarousel.js"></script>
	<script type="text/javascript" src="{{ MEDIA_URL }}/js/swfobject.js" ></script>

	<script type="text/javascript" src="{{ MEDIA_URL }}/js/jquery/hoverIntent.js"></script>
	<script type="text/javascript" src="{{ MEDIA_URL }}/js/jquery/superfish.js"></script>

	<!-- Scripts for Media Slider -->
    <script type="text/javascript" src="{{ MEDIA_URL }}/js/jquery/jquery.simplemodal.js"></script>
	<script type="text/javascript" src="{{ MEDIA_URL }}/js/project_sheet/media.js"></script>

	<!-- Sidebar -->
	<script type="text/javascript" src="{{ MEDIA_URL }}/js/project_sheet/sidebar.js"></script>
    
    <!-- Custom checkbox -->
    <script type="text/javascript" src="{{ MEDIA_URL }}/js/jquery/jquery.simpleImageCheck-0.4.js"></script>

  <script type="text/javascript">
 
    $(document).ready(function(){ 
        $("ul.sf-menu").superfish({delay: 400, speed: 'fast'}); 
    }); 
  </script>


  <script type="text/javascript">
    $(document).ready(function() {
	var tags = $("#themes_tags").tagit({
	    itemName: 'themes',
	});

	$("#themes_list").tagcloud({type:"sphere", sizemin:10, height: 200, colormin: "888888", colormax: "343434"}).find("li").tsort();

	$("#themes_list li").click(function($this) {
	    $.fn.tagit.create_tag($(this).text());
	});

	// restore tags in get
        {% if project_translation %}
          {% tags_for_object project_translation as project_tags %}
        	{% for tag in project_tags %}
	     $.fn.tagit.create_tag("{{ tag }}");
	  {% endfor %}
        {% endif %}

    });
  </script>


  <script type="text/javascript">
    function on_project_themes_updated(data) {
        if ( data == Dajaxice.EXCEPTION ) { alert('error'); }
        else {
           $('#opened-sidebar').slideToggle();
           location.reload();
        } 


    }

    function project_update_related() {
        //$('#search').block({message: 'Recherche en cours, patientez svp...'});
	//$('#search-results').fadeTo('fast', 0.3);
	//$('#search-results-wrapper').activity({width: 6, valign: 'center', padding: '20'});
        //$('#themes-form')

	themes_form = $('#themes-form').serializeObject(true);

        Dajaxice.apps.project_sheet.project_update_related(on_project_themes_updated, {'language_code': '{{ LANGUAGE_CODE }}',
                                                                                       'related_form': themes_form,
                                                                                       'project_slug': '{{ project_translation.slug }}'}
        );                                                          
	return false;
    }


  </script>

  <script type="text/javascript">
    $(document).ready(function() {

     /* FIXME: These two functions need to be merged somewhat */
     function edit_callback(value, settings) {
       var fieldname = $(this).prev('div').attr('id');

       Dajaxice.apps.project_sheet.project_sheet_edit_field(Dajax.process, {'fieldname': fieldname, 
                                                                            'value': value
                                                                            {% if project_translation %}, 'project_slug': '{{ project_translation.slug }}' {% endif %},
                                                                            'language_code': "{{ LANGUAGE_CODE }}"
       });

       $(this).removeClass('empty');


       $(this).hide().fadeIn()

       return(value);
     };

     function edit_about_callback(value, settings) {
       var fieldname = $(this).parent('div').attr('id');

       Dajaxice.apps.project_sheet.project_sheet_edit_field(Dajax.process, {'fieldname': fieldname, 
                                                                            'value': value
                                                                            {% if project_translation %}, 'project_slug': '{{ project_translation.slug }}' {% endif %},
                                                                            'language_code': "{{ LANGUAGE_CODE }}"
       });

       $(this).removeClass('empty');


       $(this).hide().fadeIn()

       return(value);
     };


     /* FIXME: This needs to be factorized */
     $('.project_description_txt').editable(edit_about_callback,
                                        {event: 'dblclick',
                                         tooltip: 'Double-click to edit',
                                         indicator: 'Saving...',
                                         type: 'textarea',
                                         height: '80px',
                                         width: '535px',
                                         cancel: "<input  title='{% trans 'Cancel'|capfirst %}'  class='redbutton right nomargin' style='margin-left:4px;' type='image' src='{{ MEDIA_URL }}/images/base/x.png' alt='X'/>",
                                         submit: "<input title='{% trans 'Ok'|capfirst %}'  class='greenbutton right nomargin' style='margin-left:4px;' type='image' src='{{ MEDIA_URL }}/images/base/v.png' alt='Ok'/>",
                                         onblur: 'ignore',
                                         cssclass: 'inline-edit',
                                         placeholder: "{% trans "This bloc is empty : don’t forget to fill it !"|capfirst %}"
                                         });



     $('.project_details_body').editable(edit_callback,
                                         {event: 'dblclick',
                                          tooltip: 'Double-click to edit',
                                          indicator: 'Saving...',
                                          type: 'textarea',
                                          height: '80px',
                                          width: '690px',
                                          cancel: "<input title='{% trans 'Cancel'|capfirst %}' class='redbutton right nomargin' style='margin-left:4px;' type='image' src='{{ MEDIA_URL }}/images/base/x.png' alt='X'/>",
                                          submit: "<input title='{% trans 'Ok'|capfirst %}' class='greenbutton right nomargin' style='margin-left:4px;' type='image' src='{{ MEDIA_URL }}/images/base/v.png' alt='Ok'/>",
                                          onblur: 'ignore',
                                          cssclass: 'inline-edit',
                                          placeholder: "{% trans "This bloc is empty : don’t forget to fill it ! A good project is a complete project !"|capfirst %}"
                                          });

    $('.project_details_body').dblclick(function() {
      $('a.editing-button').fadeOut('fast');
    });

    $('.project_details_title_edit .button').click(function() {
      $(this).parent().next('.project_details_body').dblclick();
       return false;
    });

    $('.project_description .button').click(function() {
	$('.project_description_txt').dblclick();
       return false;
    });

    /*
     * TODO: only related to the fadeIn/Out of edition button
     * can be externalized
     */
    {% if project_translation %}
        $('a.editing-button').hide();
        $('a.editing-button').each(function(){
        	var button = $(this);
        	$(this).parents("div").first().hover(function() {
        		button.show();
        	},function() {
        		button.fadeOut('fast');
            }
        	);
        });  
    {% endif %}
    
    });
  </script>

  <script type="text/javascript">
    $(document).ready(function() {
	var project_infos_block_edit = $('#project_infos_block_edit')
	var project_infos_block = $('#project_infos_block');
	var project_infos_edit_button = $('#project_infos_block_edit_button');
	var project_infos_edit_button_cancel = $('#project_infos_block_edit_button_cancel');

	project_infos_block_edit.hide();

	/* When clicking on the edit pencil, for the project infos section */
	project_infos_edit_button.click(function() {
	    project_infos_block.hide();
	    project_infos_block_edit.show();

	    return false;
	});

	/* When clicking on the [X] button in inline edit mode */
	project_infos_edit_button_cancel.click(function() {
	    project_infos_block_edit.hide();
	    project_infos_block.show();
	    project_infos_edit_button.hide();

	    return false;
	});
    });
  </script>

  <!-- References section -->
  <script type="text/javascript">
    $(document).ready(function() {
    	$('#reference_form').hide();
    	$('#edit_references_button').click(function(){
    		$('#edit_references_button').hide()
    		$('#reference_list').hide();
    		$('#reference_form').show('slow');
    		return false;
    	});
        $('li.ref input[type=checkbox]').simpleImageCheck({
              image: '{{ MEDIA_URL }}/images/check_off.png',
              imageChecked: '{{ MEDIA_URL }}/images/check_on.png',
              afterCheck: function(isChecked) {
                  input = $(this).parent().find('input[type=text]')
                if (isChecked) {
                  input.attr('disabled', 'disabled');
                }
                else{
                  input.removeAttr("disabled");
                }
              }
        });
        
        
        
    });
  </script>

  <!-- Team section -->
  <script type="text/javascript">
    $(document).ready(function() {
	$("#member_list_edit").hide();

	$(".grey_column_team_buttons").hide();

	$("#member_list li").hover(function() {
	    $(this).find(".grey_column_team_buttons").show();
	}, function() {
	    $(this).find(".grey_column_team_buttons").fadeOut("fast");
	});
    });
  </script>


{% endblock %}


{% block nav %} {% include "nav.html" %} {% endblock %}

{% block project_content %}	
  <div class="grid_13 alpha project_content">

    <!-- PROJECT TITLE -->
    {% if title_form %}
      <!-- PROJECT TITLE - edition mode-->
      {% if project_translation %}
	<form id="title" action="{% url  project_sheet-instance-edit-field project_translation.slug 'title' %}" method="post">{% csrf_token %}
      {% else %}
	<form id="title" action="{% url project_sheet-edit-field 'title' %}" method="post">{% csrf_token %}
      {% endif %}
      {{title_form.title}}
      <input id="project_title_cancel" type="reset" onclick="history.back()" value="&nbsp;" alt="X" title="{% trans 'Cancel'|capfirst %}"  />
      <input id="project_title_submit" type="submit" value="&nbsp;" alt="V" title="{% trans 'Ok'|capfirst %}"  />
	</form>

      {% else %}
	{% if project_translation %}
	  <!-- PROJECT TITLE - filled -->
	  <a href="{% url project_sheet-instance-edit-field project_translation.slug 'title' %}">
	    <div id="project_title">{{ project_translation.title }}</div>
	  </a>
	{% else %}
	  <!-- PROJECT TITLE - empty -->
	  <a href="{% url project_sheet-edit-field 'title' %}">
	    <div id="project_title_edit_inactive">{% trans 'my project title'|capfirst %}</div>
	  </a>
	{% endif %}
      {% endif %}
      

      <!-- BASELINE -->
      {% if baseline_form %}
	<!-- BASELINE - edition mode-->
	{% if project_translation %}

	<form id="baseline" action="{% url project_sheet-instance-edit-field project_translation.slug 'baseline' %}" method="post" class="project_baseline_edition">{% csrf_token %}
	{% else %}
	<form id="baseline" action="{% url project_sheet-edit-field 'baseline'%}" method="post" class="project_baseline_edition">{% csrf_token %}
	{% endif %}
	{{ baseline_form.baseline }}
	<input  title="{% trans 'Ok'|capfirst %}" class="greenbutton" type="image"  src="{{ MEDIA_URL }}/images/base/v.png" alt="Ok" />
    <a class="button redbutton nomargin "  href="javascript:history.back(1)" title="{% trans 'Cancel'|capfirst %}" class="button editing-button"><img src="{{ MEDIA_URL }}/images/base/x.png" alt="X" /></a>
	</form>
	{% else %}
	  {% if project_translation %}
	    <!-- BASELINE - filled-->
	    <div class="project_baseline focus">
	      <p>{{ project_translation.baseline }}</p>
	      <a title="{% trans 'Edit'|capfirst %}" href="{% url project_sheet-instance-edit-field project_translation.slug 'baseline' %}" class="button editing-button right"><img src="{{ MEDIA_URL }}/images/base/edit.png" /></a>
	    </div>
	  {% else %}
	    <!--  BASELINE - empty -->
	    <div class="project_baseline_edition_inactive">
	      <p>{% trans "One line description"|capfirst %}</p>
	      <a title="{% trans 'Edit'|capfirst %}" href="{% url project_sheet-edit-field 'baseline' %}" class="button editing-button right"><img src="{{ MEDIA_URL }}/images/base/edit.png"/></a>
	    </div>
	  {% endif %}
	{% endif %}					
	
	<!-- PROJECT INFOS - existing project - viewable version -->
	<div id="project_infos_block">
	  {% if project_translation %} 
	  
		<!-- edition of the full information block  -->
		<a href="#" id="project_infos_block_edit_button" title="{% trans 'Edit'|capfirst %}" class="button editing-button right"><img src="{{ MEDIA_URL }}/images/base/edit.png" alt="edit" /></a>

		<!-- add the creation date + the author (this info is auto-filled if a "Project Leader" is defined in the "Team" section) 
		<div class="creation_date">
	    Created {{ project_translation.created }} {% trans 'by' %} 
	    <i>
	      {% if project.author %}
		{{ project.author.get_full_name_or_username }}
	      {% else %}
		{% trans 'anonymous'|capfirst %}
	      {% endif %}
	    </i>
	    ({{ project.ip_addr }})
	    </div> -->
	    
		<div class="location">{% trans "Location:" %}
		{% if project.location %}
			<!-- Add the script for GPS coordonates on hover of the picture + add the GPS coordonates in alt text  -->
			{% if project.location.address %}
            {{ project.location.address }} -
            {% endif %}
			  <img src="{{ project.location.country.flag }}" alt="{{ project.location.country }}"/> {{ project.location.country.name }}
			{% if project.location.lat %}
			<img src="{{ MEDIA_URL }}/images/project/globe.png" alt="#"/>
			{% endif %}
		{% else %}
			<em>{% trans 'unknown'|capfirst %}</em>
		{% endif %}
		</div>
		
		<!-- Website -->
		{% if project.website %}
		  <div class="website">{% trans "Website:" %} <a href="{{ project.website }}">{{ project.website }}</a></div>
		{% endif %}
	   
		
	  {% endif %}
	</div>
	
	
	<!-- PROJECT INFOS - editing version -->
	<div id="project_infos_block_edit">
	  <form action="" method="post">
	    {% csrf_token %}

	    {{ project_info_form.as_p }}
 	    {{ project_location_form.as_p }}
	    <div class="clear"></div>
	    <input title="{% trans 'Ok'|capfirst %}" class="button greenbutton nomargin right" type="image" src="{{ MEDIA_URL }}/images/base/v.png" alt="Ok" />							
	    <input id="project_infos_block_edit_button_cancel" title="{% trans 'Cancel'|capfirst %}"  class="button redbutton nomargin right" type="image" src="{{ MEDIA_URL }}/images/base/x.png" alt="X" />
	  </form>	
	</div>
	
	
	
	
	
	{% include "project_sheet/media_gallery.html"%}
	
	<!-- PROJECT DESCRIPTION -->
	<div class="project_description">
	  {% include "project_sheet/about_section.html" %}
	</div>					
	

	<!-- PROJECT DETAILS -->
	<div class="project_details">
	  {% include "project_sheet/uniqueness_section.html" %}
	  
	  {% include "project_sheet/value_section.html" %}
	  
	  {% include "project_sheet/scalability_section.html" %}
	</div>
	
	<div class="clear"></div>
	
	{% include "project_sheet/references_section.html" %}
	
	<div class="clear"></div>

	<div id="license-note">
	  {% blocktrans %}
	    This project sheet, except media, is licensed under the <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons CC-BY-SA 3.0</a> <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"><img alt="Contrat Creative Commons" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/80x15.png" /></a>
	  {% endblocktrans %}
	</div>
	
      </div>
      
    <!-- GREY COLUMN - closed (default) -->
	{% include "project_sheet/grey_column.html"%}

	
	<!-- GREY COLUMN - RELATED - opened -->
	{% include "project_sheet/sidebar_related.html"%}
	
	<!-- GREY COLUMN - TEAM - opened -->
	{% include "project_sheet/sidebar_team.html"%}

{% endblock %}
